<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lifestyle & Health Research Survey - MTurk</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .hidden { display: none !important; }
        .scale-rating { transition: all 0.3s ease; }
        .scale-option:hover { transform: scale(1.05); }
        .continue-btn:hover { transform: translateY(-1px); }
        .error-message { 
            background-color: #fef2f2; 
            border: 1px solid #fecaca; 
            color: #dc2626; 
            padding: 12px; 
            border-radius: 8px; 
            margin-bottom: 16px; 
        }
        .highlight-required {
            border: 2px solid #dc2626 !important;
            background-color: #fef2f2 !important;
            border-radius: 8px;
            padding: 12px;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <div id="app" class="py-6 px-4">
        <div class="max-w-4xl mx-auto">
            <!-- Header -->
            <div class="bg-white p-6 rounded-lg shadow-sm mb-6">
                <h1 class="text-3xl font-bold mb-2">Lifestyle & Health Research Survey - MTurk</h1>
                <p class="text-gray-600">A research survey about lifestyle habits and health-related topics. Takes approximately 3-5 minutes to complete. Payment varies based on sections you qualify for.</p>
            </div>

            <!-- Progress Bar -->
            <div id="progress-container" class="bg-white p-4 rounded-lg shadow-sm mb-6">
                <div class="text-sm text-gray-500 mb-2"><span id="current-section">9% complete</span></div>
                <div class="w-full bg-gray-200 rounded-full h-3">
                    <div id="progress-bar" class="bg-blue-600 h-3 rounded-full transition-all duration-500" style="width: 9%"></div>
                </div>
            </div>

            <!-- Error Message Container -->
            <div id="error-container" class="hidden"></div>

            <!-- Survey Sections -->
            <div id="survey-content" class="bg-white p-6 rounded-lg shadow-sm">
                <!-- Content will be dynamically inserted here -->
            </div>

            <!-- Continue Button -->
            <div id="continue-container" class="mt-8 text-center">
                <button id="continue-btn" class="continue-btn bg-blue-600 text-white px-8 py-3 text-lg rounded-lg hover:bg-blue-700 transition-all shadow-lg font-medium">
                    Continue
                </button>
            </div>
        </div>
    </div>

    <script>
        // Survey state
        let currentSection = 1;
        let responses = {};
        let qualifications = {
            cannabis: false,
            ketamine: false,
            medSpa: false
        };
        let isComplete = false;

        // DOM elements
        const surveyContent = document.getElementById('survey-content');
        const continueBtn = document.getElementById('continue-btn');
        const progressContainer = document.getElementById('progress-container');
        const continueContainer = document.getElementById('continue-container');
        const currentSectionSpan = document.getElementById('current-section');
        const progressBar = document.getElementById('progress-bar');
        const errorContainer = document.getElementById('error-container');

        // Show error message and highlight missing fields
        function showError(message, highlightFields = []) {
            errorContainer.innerHTML = `<div class="error-message">${message}</div>`;
            errorContainer.classList.remove('hidden');
            
            // Remove previous highlights
            document.querySelectorAll('.highlight-required').forEach(el => {
                el.classList.remove('highlight-required');
            });
            
            // Highlight missing fields
            highlightFields.forEach(fieldName => {
                const field = document.querySelector(`input[name="${fieldName}"]`);
                if (field) {
                    const container = field.closest('div');
                    container.classList.add('highlight-required');
                }
            });
            
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Hide error message
        function hideError() {
            errorContainer.classList.add('hidden');
        }

        // Update progress bar
        function updateProgress() {
            const percentage = Math.round((currentSection / 11) * 100);
            currentSectionSpan.textContent = `${percentage}% complete`;
            progressBar.style.width = `${percentage}%`;
        }

        // Update response
        function updateResponse(questionId, value) {
            responses[questionId] = value;
            
            if (currentSection === 1) {
                checkQualifications();
            }
        }

        // Check qualifications based on section 1 responses
        function checkQualifications() {
            qualifications.cannabis = ['monthly', 'weekly', 'daily'].includes(responses.cannabis_usage);
            qualifications.ketamine = responses.ketamine_usage === 'yes';
            qualifications.medSpa = responses.med_spa_usage === 'yes';
        }

        // Create radio group
        function createRadioGroup(name, options, required = true) {
            return options.map(option => {
                const value = typeof option === 'string' ? option : option.value;
                const label = typeof option === 'string' ? option.charAt(0).toUpperCase() + option.slice(1) : option.label;
                
                return `
                    <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                        <input type="radio" name="${name}" value="${value}" ${required ? 'data-required="true"' : ''} 
                               class="mr-3 w-4 h-4" onchange="updateResponse('${name}', this.value)">
                        <span>${label}</span>
                    </label>
                `;
            }).join('');
        }

        // Create scale rating
        function createScaleRating(questionId, label, required = true) {
            return `
                <div class="mb-6 p-4 bg-white rounded-lg shadow-sm border">
                    <label class="block text-sm font-medium mb-3 text-gray-800">${label} ${required ? '*' : ''}</label>
                    <div class="flex items-center justify-between">
                        <span class="text-xs text-gray-500 hidden sm:block">Very Dissatisfied</span>
                        <div class="flex space-x-6 sm:space-x-8">
                            ${[1,2,3,4,5].map(value => `
                                <label class="scale-option flex flex-col items-center cursor-pointer p-2">
                                    <input type="radio" name="${questionId}" value="${value}" ${required ? 'data-required="true"' : ''} 
                                           class="mb-1 w-4 h-4" onchange="updateResponse('${questionId}', this.value)">
                                    <span class="text-sm font-medium">${value}</span>
                                </label>
                            `).join('')}
                        </div>
                        <span class="text-xs text-gray-500 hidden sm:block">Very Satisfied</span>
                    </div>
                    <div class="flex justify-between mt-2 sm:hidden">
                        <span class="text-xs text-gray-500">Very Dissatisfied</span>
                        <span class="text-xs text-gray-500">Very Satisfied</span>
                    </div>
                </div>
            `;
        }

        // Handle checkbox change
        function handleCheckboxChange(name, checkbox) {
            if (!responses[name]) responses[name] = [];
            
            if (checkbox.checked) {
                responses[name].push(checkbox.value);
            } else {
                responses[name] = responses[name].filter(item => item !== checkbox.value);
            }
        }

        // Validate required fields
        function validateCurrentSection() {
            hideError();
            
            const missingFields = [];
            
            // Get all required radio button groups
            const requiredRadioNames = new Set();
            document.querySelectorAll('input[type="radio"][data-required="true"]').forEach(radio => {
                requiredRadioNames.add(radio.name);
            });
            
            // Check each required radio group
            for (let groupName of requiredRadioNames) {
                const groupRadios = document.querySelectorAll(`input[name="${groupName}"]`);
                const isChecked = Array.from(groupRadios).some(radio => radio.checked);
                if (!isChecked) {
                    missingFields.push(groupName);
                }
            }
            
            // Check required text inputs
            const requiredInputs = document.querySelectorAll('input[type="text"][data-required="true"]');
            for (let input of requiredInputs) {
                if (!input.value.trim()) {
                    // Create a unique field name for text inputs
                    const fieldName = input.previousElementSibling.textContent.replace(' *', '').toLowerCase().replace(/[^a-z0-9]/g, '_');
                    missingFields.push(fieldName);
                    input.closest('div').setAttribute('data-field-name', fieldName);
                }
            }
            
            if (missingFields.length > 0) {
                showError('Please answer all required questions to advance.', missingFields);
                return false;
            }
            
            return true;
        }

        // Section 1: Lifestyle Questions
        function renderSection1() {
            return `
                <h2 class="text-2xl font-bold mb-4">Lifestyle Questions</h2>
                <p class="mb-6 text-gray-600">Please answer the following questions about your lifestyle and habits.</p>
                
                <div class="space-y-6">
                    <div>
                        <label class="block text-sm font-medium mb-3">In the past 12 months, how often have you used cannabis? *</label>
                        <div class="space-y-2">
                            ${createRadioGroup('cannabis_usage', ['never', 'rarely', 'monthly', 'weekly', 'daily'])}
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium mb-3">Have you used ketamine in the past 12 months? *</label>
                        <div class="space-y-2">
                            ${createRadioGroup('ketamine_usage', ['yes', 'no'])}
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium mb-3">In the past month, have you received procedures like Botox, laser hair removal, CoolSculpting, dermal fillers, or similar treatments at a med spa? *</label>
                        <div class="space-y-2">
                            ${createRadioGroup('med_spa_usage', ['yes', 'no'])}
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium mb-3">How often do you drink alcohol? *</label>
                        <div class="space-y-2">
                            ${createRadioGroup('alcohol_usage', ['never', 'rarely', 'monthly', 'weekly', 'daily'])}
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium mb-3">How often do you use nicotine/vaping products? *</label>
                        <div class="space-y-2">
                            ${createRadioGroup('nicotine_usage', ['never', 'rarely', 'monthly', 'weekly', 'daily'])}
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium mb-3">How many hours of sleep do you typically get per night? *</label>
                        <div class="space-y-2">
                            ${createRadioGroup('sleep_hours', [
                                { value: 'less_than_5', label: 'Less than 5 hours' },
                                { value: '5_6', label: '5-6 hours' },
                                { value: '7_8', label: '7-8 hours' },
                                { value: 'more_than_8', label: 'More than 8 hours' }
                            ])}
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium mb-3">How often do you exercise per week? *</label>
                        <div class="space-y-2">
                            ${createRadioGroup('exercise_frequency', [
                                { value: 'never', label: 'Never' },
                                { value: '1_2', label: '1-2 times' },
                                { value: '3_4', label: '3-4 times' },
                                { value: '5_plus', label: '5+ times' }
                            ])}
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium mb-3">Please select "Weekly" for this question to show you are paying attention. *</label>
                        <div class="space-y-2">
                            ${createRadioGroup('attention_check', ['never', 'rarely', 'monthly', 'weekly', 'daily'])}
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium mb-3">How often do you drink coffee? *</label>
                        <div class="space-y-2">
                            ${createRadioGroup('coffee_usage', ['never', 'rarely', 'monthly', 'weekly', 'daily'])}
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium mb-3">How many hours per day do you spend on social media? *</label>
                        <div class="space-y-2">
                            ${createRadioGroup('social_media_hours', [
                                { value: 'less_than_1', label: 'Less than 1 hour' },
                                { value: '1_2', label: '1-2 hours' },
                                { value: '3_4', label: '3-4 hours' },
                                { value: '5_plus', label: '5+ hours' }
                            ])}
                        </div>
                    </div>
                </div>
            `;
        }

        // Section 2: Cannabis Method Selection
        function renderSection2() {
            return `
                <h2 class="text-2xl font-bold mb-4">Cannabis Research Section</h2>
                <p class="mb-6 text-gray-600">Based on your previous answers, you qualify for this research section. Please answer the following questions about cannabis use.</p>
                
                <div>
                    <label class="block text-sm font-medium mb-3">Which method do you use MOST OFTEN to purchase cannabis? *</label>
                    <div class="space-y-2">
                        <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                            <input type="radio" name="cannabis_method" value="dispensary" data-required="true" 
                                   class="mr-3 w-4 h-4" onchange="updateResponse('cannabis_method', this.value)">
                            Dispensary (physical store)
                        </label>
                        <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                            <input type="radio" name="cannabis_method" value="delivery" data-required="true" 
                                   class="mr-3 w-4 h-4" onchange="updateResponse('cannabis_method', this.value)">
                            Delivery service
                        </label>
                    </div>
                </div>
            `;
        }

        // Section 3: Dispensary Section
        function renderSection3() {
            return `
                <h2 class="text-2xl font-bold mb-6">Dispensary Section</h2>
                
                <div class="space-y-6">
                    <div>
                        <label class="block text-sm font-medium mb-2">What is the name of the dispensary you most recently made a purchase from? *</label>
                        <input type="text" data-required="true" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                               oninput="updateResponse('dispensary_name', this.value)">
                    </div>

                    <div>
                        <label class="block text-sm font-medium mb-2">Please input the city and state for the dispensary you most recently made a purchase from. (example Denver, CO) *</label>
                        <input type="text" data-required="true" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                               oninput="updateResponse('dispensary_location', this.value)">
                    </div>

                    <div>
                        <label class="block text-sm font-medium mb-3">How do you primarily use cannabis? *</label>
                        <div class="space-y-2">
                            ${createRadioGroup('cannabis_use_type', ['Medical only', 'Recreational only', 'Both medical and recreational'])}
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium mb-3">How often do you visit dispensaries? *</label>
                        <div class="space-y-2">
                            ${createRadioGroup('dispensary_frequency', ['Weekly or more', '2-3 times per month', 'Monthly', 'Every few months', 'Rarely (few times per year)'])}
                        </div>
                    </div>

                    <div>
                        <h3 class="text-lg font-semibold mb-4">Satisfaction Ratings</h3>
                        <p class="text-sm text-gray-600 mb-6">Rate your satisfaction with your most recent dispensary experience. Scale: 1 = Very Dissatisfied, 5 = Very Satisfied</p>
                        
                        <div class="space-y-2">
                            ${[
                                'Parking availability and convenience',
                                'Ease of finding the location',
                                'Wait time to be served',
                                'Staff greeting and welcoming attitude',
                                'Staff friendliness throughout visit',
                                'Staff knowledge about products',
                                'Staff ability to answer your questions',
                                'Staff recommendations quality',
                                'Product selection and variety',
                                'Product quality',
                                'Product availability (items in stock)',
                                'Pricing clarity and transparency',
                                'Value for money',
                                'Checkout process speed',
                                'Payment options available',
                                'Store cleanliness',
                                'Store organization and layout',
                                'Store atmosphere and comfort',
                                'Security and safety measures',
                                'Overall experience'
                            ].map(item => createScaleRating(`dispensary_${item.replace(/[^a-zA-Z0-9]/g, '_').toLowerCase()}`, item)).join('')}
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium mb-3">How likely are you to return to this dispensary? *</label>
                        <div class="space-y-2">
                            ${createRadioGroup('dispensary_return_likelihood', ['Extremely likely', 'Very likely', 'Somewhat likely', 'Not very likely', 'Not at all likely'])}
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium mb-3">How likely are you to recommend this dispensary to others? *</label>
                        <div class="space-y-2">
                            ${createRadioGroup('dispensary_recommend_likelihood', ['Extremely likely', 'Very likely', 'Somewhat likely', 'Not very likely', 'Not at all likely'])}
                        </div>
                    </div>
                </div>
            `;
        }

        // Section 4: Cannabis Delivery Section
        function renderSection4() {
            return `
                <h2 class="text-2xl font-bold mb-6">Cannabis Delivery Section</h2>
                
                <div class="space-y-6">
                    <div>
                        <label class="block text-sm font-medium mb-2">What is the name of the cannabis delivery service you most recently used? *</label>
                        <input type="text" data-required="true" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                               oninput="updateResponse('delivery_name', this.value)">
                    </div>

                    <div>
                        <label class="block text-sm font-medium mb-2">Please input the city and state for the cannabis delivery service you used most recently. (example - Denver, CO) *</label>
                        <input type="text" data-required="true" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                               oninput="updateResponse('delivery_location', this.value)">
                    </div>

                    <div>
                        <label class="block text-sm font-medium mb-3">How do you primarily use cannabis? *</label>
                        <div class="space-y-2">
                            ${createRadioGroup('delivery_cannabis_use_type', ['Medical only', 'Recreational only', 'Both medical and recreational'])}
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium mb-3">How often do you use cannabis delivery services? *</label>
                        <div class="space-y-2">
                            ${createRadioGroup('delivery_frequency', ['Weekly or more', '2-3 times per month', 'Monthly', 'Every few months', 'This was my first delivery order'])}
                        </div>
                    </div>

                    <div>
                        <h3 class="text-lg font-semibold mb-4">Satisfaction Ratings</h3>
                        <p class="text-sm text-gray-600 mb-6">Rate your satisfaction with your most recent delivery experience. Scale: 1 = Very Dissatisfied, 5 = Very Satisfied</p>
                        
                        <div class="space-y-2">
                            ${[
                                'Online menu/website ease of use',
                                'Product selection and variety available',
                                'Product information and descriptions',
                                'Pricing transparency and clarity',
                                'Online ordering process',
                                'Payment process security and ease',
                                'Order confirmation and communication',
                                'Delivery time accuracy (delivered when promised)',
                                'Delivery scheduling flexibility',
                                'Driver professionalism and courtesy',
                                'Driver knowledge about products',
                                'ID verification process',
                                'Product packaging and discretion',
                                'Product quality upon arrival',
                                'Order accuracy (correct items delivered)',
                                'Delivery fees and minimum order transparency',
                                'Customer service responsiveness',
                                'Text/call updates during delivery',
                                'Value for money including delivery costs',
                                'Overall delivery experience'
                            ].map(item => createScaleRating(`delivery_${item.replace(/[^a-zA-Z0-9]/g, '_').toLowerCase()}`, item)).join('')}
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium mb-3">How likely are you to use this delivery service again? *</label>
                        <div class="space-y-2">
                            ${createRadioGroup('delivery_return_likelihood', ['Extremely likely', 'Very likely', 'Somewhat likely', 'Not very likely', 'Not at all likely'])}
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium mb-3">How likely are you to recommend this delivery service to others? *</label>
                        <div class="space-y-2">
                            ${createRadioGroup('delivery_recommend_likelihood', ['Extremely likely', 'Very likely', 'Somewhat likely', 'Not very likely', 'Not at all likely'])}
                        </div>
                    </div>
                </div>
            `;
        }

        // Section 5: Ketamine Setting Selection
        function renderSection5() {
            return `
                <h2 class="text-2xl font-bold mb-4">Ketamine Research Section</h2>
                <p class="mb-6 text-gray-600">Based on your previous answers, you qualify for this research section. Please answer the following questions about ketamine use.</p>
                
                <div>
                    <label class="block text-sm font-medium mb-3">In what setting did you MOST RECENTLY use ketamine? *</label>
                    <div class="space-y-2">
                        <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                            <input type="radio" name="ketamine_setting" value="clinical" data-required="true" 
                                   class="mr-3 w-4 h-4" onchange="updateResponse('ketamine_setting', this.value)">
                            Clinical/medical setting (doctor's office, clinic)
                        </label>
                        <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                            <input type="radio" name="ketamine_setting" value="other" data-required="true" 
                                   class="mr-3 w-4 h-4" onchange="updateResponse('ketamine_setting', this.value)">
                            Other setting
                        </label>
                    </div>
                </div>
            `;
        }

        // Section 6: Ketamine Clinic Section
        function renderSection6() {
            return `
                <h2 class="text-2xl font-bold mb-6">Ketamine Clinic Section</h2>
                
                <div class="space-y-6">
                    <div>
                        <label class="block text-sm font-medium mb-2">What is the name of the ketamine clinic you most recently visited? *</label>
                        <input type="text" data-required="true" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                               oninput="updateResponse('ketamine_clinic_name', this.value)">
                    </div>

                    <div>
                        <label class="block text-sm font-medium mb-2">Please input the city and state for the clinic you most recently visited. (example - Denver, CO) *</label>
                        <input type="text" data-required="true" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                               oninput="updateResponse('ketamine_clinic_location', this.value)">
                    </div>

                    <div>
                        <label class="block text-sm font-medium mb-3">What type of ketamine treatment do you receive? *</label>
                        <div class="space-y-2">
                            ${createRadioGroup('ketamine_treatment_type', ['Medical/therapeutic ketamine (depression, anxiety, PTSD, etc.)', 'Recreational/wellness ketamine', 'Both medical and recreational'])}
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium mb-3">How many ketamine sessions have you completed total? *</label>
                        <div class="space-y-2">
                            ${createRadioGroup('ketamine_sessions_total', ['1-3 sessions', '4-6 sessions', '7-12 sessions', '13+ sessions'])}
                        </div>
                    </div>

                    <div>
                        <h3 class="text-lg font-semibold mb-4">Satisfaction Ratings</h3>
                        <p class="text-sm text-gray-600 mb-6">Rate your satisfaction with your most recent clinic experience. Scale: 1 = Very Dissatisfied, 5 = Very Satisfied</p>
                        
                        <div class="space-y-2">
                            ${[
                                'Appointment scheduling ease',
                                'Appointment availability/timing options',
                                'Check-in process',
                                'Wait time before treatment',
                                'Reception staff friendliness',
                                'Medical staff professionalism',
                                'Medical staff expertise and knowledge',
                                'Pre-treatment consultation quality',
                                'Treatment explanation and preparation',
                                'Treatment room comfort',
                                'Treatment room environment/ambiance',
                                'Privacy and confidentiality',
                                'Monitoring and safety during treatment',
                                'Staff availability during treatment',
                                'Post-treatment care and observation',
                                'Pricing transparency',
                                'Value for cost of treatment',
                                'Facility cleanliness',
                                'Follow-up communication',
                                'Overall treatment experience'
                            ].map(item => createScaleRating(`ketamine_clinic_${item.replace(/[^a-zA-Z0-9]/g, '_').toLowerCase()}`, item)).join('')}
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium mb-3">How likely are you to continue treatment at this clinic? *</label>
                        <div class="space-y-2">
                            ${createRadioGroup('ketamine_clinic_return_likelihood', ['Extremely likely', 'Very likely', 'Somewhat likely', 'Not very likely', 'Not at all likely'])}
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium mb-3">How likely are you to recommend this clinic to others? *</label>
                        <div class="space-y-2">
                            ${createRadioGroup('ketamine_clinic_recommend_likelihood', ['Extremely likely', 'Very likely', 'Somewhat likely', 'Not very likely', 'Not at all likely'])}
                        </div>
                    </div>
                </div>
            `;
        }

        // Section 7: Ketamine Online Provider Section
        function renderSection7() {
            return `
                <h2 class="text-2xl font-bold mb-6">Ketamine Online Provider Section</h2>
                
                <div class="space-y-6">
                    <div>
                        <label class="block text-sm font-medium mb-2">What is the name of the online ketamine provider you most recently used? *</label>
                        <input type="text" placeholder="Examples: Mindbloom, Nue Life, Wondermed, Better U Care, Joyous, etc." 
                               data-required="true" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                               oninput="updateResponse('ketamine_online_name', this.value)">
                    </div>

                    <div>
                        <label class="block text-sm font-medium mb-3">What type of ketamine treatment do you receive? *</label>
                        <div class="space-y-2">
                            ${createRadioGroup('ketamine_online_treatment_type', ['Medical/therapeutic ketamine (depression, anxiety, PTSD, etc.)', 'Recreational/wellness ketamine', 'Both medical and recreational'])}
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium mb-3">How many ketamine sessions have you completed with this provider? *</label>
                        <div class="space-y-2">
                            ${createRadioGroup('ketamine_online_sessions', ['1-3 sessions', '4-6 sessions', '7-12 sessions', '13+ sessions'])}
                        </div>
                    </div>

                    <div>
                        <h3 class="text-lg font-semibold mb-4">Satisfaction Ratings</h3>
                        <p class="text-sm text-gray-600 mb-6">Rate your satisfaction with your most recent online provider experience. Scale: 1 = Very Dissatisfied, 5 = Very Satisfied</p>
                        
                        <div class="space-y-2">
                            ${[
                                'Initial online assessment/screening process',
                                'Website ease of use and navigation',
                                'Provider matching and assignment',
                                'Initial virtual consultation quality',
                                'Medical provider expertise and knowledge',
                                'Treatment plan explanation and customization',
                                'Medication prescription and dosing guidance',
                                'Medication delivery/shipping process',
                                'Treatment instructions and preparation guidance',
                                'Mobile app or online portal functionality',
                                'Virtual support during treatment sessions',
                                'Integration coaching and follow-up',
                                'Progress tracking and monitoring',
                                'Communication responsiveness between sessions',
                                'Scheduling flexibility for appointments',
                                'Pricing transparency and billing',
                                'Value for cost of treatment',
                                'Educational resources and materials',
                                'Privacy and confidentiality',
                                'Overall treatment experience'
                            ].map(item => createScaleRating(`ketamine_online_${item.replace(/[^a-zA-Z0-9]/g, '_').toLowerCase()}`, item)).join('')}
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium mb-3">How likely are you to continue treatment with this provider? *</label>
                        <div class="space-y-2">
                            ${createRadioGroup('ketamine_online_return_likelihood', ['Extremely likely', 'Very likely', 'Somewhat likely', 'Not very likely', 'Not at all likely'])}
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium mb-3">How likely are you to recommend this online provider to others? *</label>
                        <div class="space-y-2">
                            ${createRadioGroup('ketamine_online_recommend_likelihood', ['Extremely likely', 'Very likely', 'Somewhat likely', 'Not very likely', 'Not at all likely'])}
                        </div>
                    </div>
                </div>
            `;
        }

        // Section 9: Med Spa Research Section
        function renderSection9() {
            return `
                <h2 class="text-2xl font-bold mb-4">Med Spa Research Section</h2>
                <p class="mb-6 text-gray-600">Based on your previous answers, you qualify for this research section. Please answer the following questions about med spa treatments.</p>
                
                <div class="space-y-6">
                    <div>
                        <label class="block text-sm font-medium mb-2">What is the name of the med spa you visited most recently? *</label>
                        <input type="text" data-required="true" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                               oninput="updateResponse('med_spa_name', this.value)">
                    </div>

                    <div>
                        <label class="block text-sm font-medium mb-2">Please input the city and state for the med spa you visited most recently. (example - Denver, CO) *</label>
                        <input type="text" data-required="true" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                               oninput="updateResponse('med_spa_location', this.value)">
                    </div>

                    <div>
                        <label class="block text-sm font-medium mb-3">What services did you receive during your most recent visit? *</label>
                        <div class="space-y-2">
                            ${createRadioGroup('med_spa_recent_services', [
                                'Botox/Dysport',
                                'Dermal fillers', 
                                'Laser treatments (hair removal, skin resurfacing, etc.)',
                                'Chemical peels',
                                'Microneedling',
                                'CoolSculpting/body contouring',
                                'Facial treatments',
                                'IV therapy/wellness injections',
                                'Other aesthetic treatments'
                            ])}
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium mb-3">How often do you visit med spas? *</label>
                        <div class="space-y-2">
                            ${createRadioGroup('med_spa_frequency', ['Monthly or more', 'Every 2-3 months', 'Every 4-6 months', '1-2 times per year', 'This was my first visit'])}
                        </div>
                    </div>

                    <div>
                        <h3 class="text-lg font-semibold mb-4">Satisfaction Ratings</h3>
                        <p class="text-sm text-gray-600 mb-6">Rate your satisfaction with your most recent med spa experience. Scale: 1 = Very Dissatisfied, 5 = Very Satisfied</p>
                        
                        <div class="space-y-2">
                            ${[
                                'Appointment booking process',
                                'Facility location and accessibility',
                                'Parking availability',
                                'Reception and check-in experience',
                                'Wait time for appointment',
                                'Reception staff friendliness',
                                'Provider/practitioner professionalism',
                                'Provider expertise and credentials',
                                'Consultation quality and thoroughness',
                                'Treatment explanation and consent process',
                                'Pain management during treatment',
                                'Comfort during treatment',
                                'Treatment room cleanliness',
                                'Treatment room ambiance',
                                'Post-treatment care instructions',
                                'Pricing transparency',
                                'Value for money',
                                'Results achieved',
                                'Follow-up and aftercare',
                                'Overall experience'
                            ].map(item => createScaleRating(`med_spa_${item.replace(/[^a-zA-Z0-9]/g, '_').toLowerCase()}`, item)).join('')}
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium mb-3">How likely are you to return to this med spa? *</label>
                        <div class="space-y-2">
                            ${createRadioGroup('med_spa_return_likelihood', ['Extremely likely', 'Very likely', 'Somewhat likely', 'Not very likely', 'Not at all likely'])}
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium mb-3">How likely are you to recommend this med spa to others? *</label>
                        <div class="space-y-2">
                            ${createRadioGroup('med_spa_recommend_likelihood', ['Extremely likely', 'Very likely', 'Somewhat likely', 'Not very likely', 'Not at all likely'])}
                        </div>
                    </div>
                </div>
            `;
        }

        // Completion screen
        function renderCompletion(code) {
            return `
                <div class="text-center">
                    <h2 class="text-3xl font-bold mb-4 text-green-600">Thank You!</h2>
                    <p class="mb-6 text-lg">Your response has been recorded.</p>
                    <div class="bg-blue-50 border-2 border-blue-200 text-blue-800 px-6 py-4 rounded-lg mb-6">
                        <p class="font-bold text-lg mb-2">Your completion code is:</p>
                        <p class="text-2xl font-mono font-bold">${code}</p>
                    </div>
                    <p class="text-gray-600">Please enter this code in MTurk to receive payment.</p>
                </div>
            `;
        }

        // Navigate to next section
        function nextSection() {
            if (!validateCurrentSection()) {
                return;
            }

            if (currentSection === 1) {
                if (!qualifications.cannabis && !qualifications.ketamine && !qualifications.medSpa) {
                    showCompletion('MTK-BASIC-2024');
                    return;
                }
                
                if (qualifications.cannabis) {
                    currentSection = 2;
                } else if (qualifications.ketamine) {
                    currentSection = 5;
                } else if (qualifications.medSpa) {
                    currentSection = 9;
                }
            } else if (currentSection === 2) {
                if (responses.cannabis_method === 'dispensary') {
                    currentSection = 3;
                } else {
                    currentSection = 4;
                }
            } else if (currentSection === 3 || currentSection === 4) {
                if (qualifications.ketamine) {
                    currentSection = 5;
                } else if (qualifications.medSpa) {
                    currentSection = 9;
                } else {
                    showCompletion('MTK-QUALIFIED-2024');
                    return;
                }
            } else if (currentSection === 5) {
                if (responses.ketamine_setting === 'clinical') {
                    currentSection = 6;
                } else {
                    currentSection = 7;
                }
            } else if (currentSection === 6 || currentSection === 7) {
                if (qualifications.medSpa) {
                    currentSection = 9;
                } else {
                    showCompletion('MTK-QUALIFIED-2024');
                    return;
                }
            } else if (currentSection === 9) {
                showCompletion('MTK-QUALIFIED-2024');
                return;
            }

            renderCurrentSection();
            updateProgress();
        }

        // Submit survey data to Google Sheets
async function submitSurveyData(completionCode) {
    const WEBHOOK_URL = 'https://script.google.com/macros/s/AKfycbz78QEIVbGn3rmWe4BZmKpy1oc7sGt5K120FoCjZPTEaT_J6Tyj7n1AdRucuVEqRiBkHg/exec'
    
    // Prepare data for submission
    const surveyData = {
        completion_code: completionCode,
        timestamp: new Date().toISOString(),
        ...responses,
        all_responses: responses
    };
    
    try {
        // Create a hidden iframe to submit data
        const iframe = document.createElement('iframe');
        iframe.style.display = 'none';
        iframe.name = 'submit_frame';
        document.body.appendChild(iframe);
        
        // Create a form that submits to the iframe
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = WEBHOOK_URL;
        form.target = 'submit_frame';
        form.style.display = 'none';
        
        // Add data as form fields
        Object.keys(surveyData).forEach(key => {
            const input = document.createElement('input');
            input.type = 'hidden';
            input.name = key;
            input.value = typeof surveyData[key] === 'object' ? JSON.stringify(surveyData[key]) : surveyData[key];
            form.appendChild(input);
        });
        
        document.body.appendChild(form);
        form.submit();
        
        // Clean up after a short delay
        setTimeout(() => {
            document.body.removeChild(form);
            document.body.removeChild(iframe);
        }, 1000);
        
        console.log('Survey data submitted successfully');
    } catch (error) {
        console.error('Error submitting survey data:', error);
    }
}

        // Show completion screen
        function showCompletion(code) {
            isComplete = true;
            
            // Submit data to Google Sheets
            submitSurveyData(code);
            
            surveyContent.innerHTML = renderCompletion(code);
            progressContainer.classList.add('hidden');
            continueContainer.classList.add('hidden');
        }

        // Render current section
        function renderCurrentSection() {
            let content = '';
            
            switch (currentSection) {
                case 1:
                    content = renderSection1();
                    break;
                case 2:
                    content = renderSection2();
                    break;
                case 3:
                    content = renderSection3();
                    break;
                case 4:
                    content = renderSection4();
                    break;
                case 5:
                    content = renderSection5();
                    break;
                case 6:
                    content = renderSection6();
                    break;
                case 7:
                    content = renderSection7();
                    break;
                case 9:
                    content = renderSection9();
                    break;
                default:
                    content = `
                        <h2 class="text-xl font-bold mb-4">Section ${currentSection}</h2>
                        <p>This section is under construction. For now, click Continue to proceed.</p>
                    `;
            }
            
            surveyContent.innerHTML = content;
            
            // Always scroll to top when new section loads
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Initialize survey
        function initSurvey() {
            renderCurrentSection();
            updateProgress();
            
            continueBtn.addEventListener('click', nextSection);
        }

        // Start survey when page loads
        document.addEventListener('DOMContentLoaded', initSurvey);
    </script>
</body>
</html>
